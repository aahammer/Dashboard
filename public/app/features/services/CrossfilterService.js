// Generated by CoffeeScript 1.7.1
(function() {
  define(['crossfilter', 'd3'], function(crossfilter, d3) {
    return function($settings) {
      var CrossfilterService;
      CrossfilterService = function($rootScope, $settings) {
        var data, dimensions, hello, resetFilters, setupData, state;
        state = {
          selection: 'speciality',
          item: null,
          module: null,
          question: null,
          measure: 'average'
        };
        data = {};
        hello = function() {
          return "world";
        };
        setupData = function() {
          d3.csv("data/data.csv", function(error, data) {
            return data.forEach(function(d, i) {
              d.total = +d.total;
              d.date = Date.parse(d.date);
              d.return_total = +d.return_total;
              d.return_rate = +d.return_rate;
              d.average = +d.average;
              d.top = +d.top;
              return d.nps = +d.nps;
            });
          });
          return crossfilter(data);
        };
        data = setupData();
        dimensions = {};
        dimensions['item'] = data.dimension(function(d) {
          return d.item;
        });
        dimensions['module'] = data.dimension(function(d) {
          return d.module;
        });
        dimensions['question'] = data.dimension(function(d) {
          return d.question;
        });
        dimensions['date'] = data.dimension(function(d) {
          return d.date;
        });
        resetFilters = function() {
          var dim, _i, _len;
          for (_i = 0, _len = dimensions.length; _i < _len; _i++) {
            dim = dimensions[_i];
            dim.filterAll();
          }
        };
        return {
          tellApplicationState: function(selection, item, module, question, measure) {
            resetFilters();
            dimensions['item'].filter(item);
            dimensions['module'].filter(module);
          },
          selections: [
            {
              name: "Speciality"
            }, {
              name: "Station"
            }
          ],
          items: [
            {
              id: "Surgery",
              total: 50
            }, {
              id: "Pediatric",
              total: 43
            }, {
              id: "Psychology",
              total: 27
            }
          ],
          modules: [
            {
              name: "Organisation"
            }, {
              name: "Treatment"
            }, {
              name: "Service"
            }
          ],
          getQuestions: function() {},
          measures: [
            {
              id: 'average',
              name: "Average"
            }, {
              id: 'top',
              name: "Topscore"
            }, {
              id: 'nps',
              name: "NPS"
            }
          ],
          getQuestionHistory: function() {}
        };
      };
      return ['$rootScope', $settings, CrossfilterService];
    };
  });


  /*
       d3.csv("test/data.csv", function(error, data) {
          console.log(data);
  
          data.forEach(function(d, i) {
              d.total = +d.total;
              d.return_total = +d.return_total;
              d.return_rate = +d.return_rate;
              d.average = +d.average;
              d.top = +d.top;
              d.nps = +d.nps;
          });
  
          specialty_satisfaction = crossfilter(data);
  
          dim_speciality   = specialty_satisfaction.dimension(function(d){return d.specialty;});
          dim_module      = specialty_satisfaction.dimension(function(d){return d.module;});
          dim_question    = specialty_satisfaction.dimension(function(d){return d.question;});
          dim_year        = specialty_satisfaction.dimension(function(d){return d.year;});
          dim_month       = specialty_satisfaction.dimension(function(d){return d.month;});
  
          measure_average = specialty_satisfaction.dimension(function(d){return d.average;});
  
          console.log(dim_speciality.group());
  
          dim_speciality.filter("surgery");
          dim_module.filter("organisation");
          console.log(dim_year.filter("2014").top(Infinity));
  
          console.log(dim_question.group().reduceSum(function(fact){return fact.average}).top(Infinity));
  
      });
   */

}).call(this);

//# sourceMappingURL=CrossfilterService.map
